[![SWUbanner](https://raw.githubusercontent.com/vshymanskyy/StandWithUkraine/main/banner2-direct.svg)](https://github.com/vshymanskyy/StandWithUkraine/blob/main/docs/README.md)

![Terraform](https://cloudarmy.io/tldr/images/tf_aws.jpg)
<br>
<br>
<br>
<br>
![GitHub tag (latest by date)](https://img.shields.io/github/v/tag/adamwshero/terraform-aws-api-gateway?color=lightgreen&label=latest%20tag%3A&style=for-the-badge)
<br>
<br>

# terraform-aws-api-gateway (V1)

Terraform module to create [Amazon API Gateway (v1)](https://aws.amazon.com/api-gateway/) resources.

Amazon API Gateway is a fully managed service that makes it easy for developers to create, publish, maintain, monitor, and secure APIs at any scale. APIs act as the "front door" for applications to access data, business logic, or functionality from your backend services. Using API Gateway, you can create RESTful APIs and WebSocket APIs that enable real-time two-way communication applications. API Gateway supports containerized and serverless workloads, as well as web applications.
<br>

Build RESTful APIs optimized for serverless workloads and HTTP backends using HTTP APIs. HTTP APIs are the best choice for building APIs that only require API proxy functionality. If your APIs require API proxy functionality and API management features in a single solution, API Gateway also offers REST APIs.
<br>

## Module Capabilities

- Uses OpenAPI 3.x Specification
- Deploy REST API to many stages
- Supports many method settings & paths for each stage
- Supports models
- Supports creation of many API Keys
- Supports creation of many stages
- Supports stage canaries.
- Supports creation of domain name and its mapping
- Supports assigning many API Keys to many usage plans
- Supports assigning many usage plans to many stages
- Supports WAF integration for stages
- Supports VPC Link for `EDGE` & `REGIONAL` type API's
- Supports VPC Endpoints for `PRIVATE` type API's
  <br>

## Distributed Architecture Example Using PrivateLink (Preferred for public API's)

![](assets/public-api-distributed-model.png)

## Distributed Architecture Example Without PrivateLink (Preferred for private API's)

- COMING SOON...
<!-- ![](assets/public-api-distributed-model-private-api.png) -->

## Assumptions

- Public API Scenario
  - You already have Network Load Balancer (NLB) with an IP type target group created if you are creating an API using the `regional` or `edge` deployment type.
  - You already have VPC Link setup and configured to point to your internal Network Load Balancer (NLB) if you are creating an API using the `regional` or `edge` deployment type.
  - You have already configured a VPC endpoint(s) that your NLB is using as targets if you are creating an API using the `regional` or `edge` deployment type. That VPC endpoint is connected to a VPC Endpoint Service in the same account or another account. (see architecture diagram)
- All Scenarios
  _ You already have created the CloudWatch Log Group for your access logging. This is different from execution log groups which is created automatically by API Gateway and is not manageable by Terraform.
  _ You already have created the IAM role and policy for API Gateway execution. This role is needed so that it can create the CloudWatch Log Group and push log streams to it.
  <br>

## Usage

- The definition of the API is managed using the OpenAPI 3.x standard and is contained in a openapi.yaml file. This file contains the paths, authorization integrations, VPC Link integrations, responses, authorizers, etc. The goal is to configure as much of the API in this .yaml as possible and use Terragrunt to manage the broader context of API Gateway. This approach also reduces greatly the amount of Terraform resources that need to be created/managed.
- The resources abstracted from Terraform and into OpenAPI spec are listed below. Because of this, there are no inputs in Terraform for the REST API itself except for the `name`, `description`, `body`, and `put_rest_api_mode`. To provide inputs for these resources, you must do so in the openapi.yaml file using the [AWS OpenAPI Extensions from the developer guide](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions.html).

  ```
  aws_api_gateway_resource
  aws_api_gateway_method
  aws_api_gateway_method_response
  aws_api_gateway_method_settings
  aws_api_gateway_integration
  aws_api_gateway_integration_response
  aws_api_gateway_gateway_response
  aws_api_gateway_model
  ```

- The API is deployed every time a change is made in Terraform. This is done to ensure that the deploy being used matches with the most recent deploy. Otherwise, this can be unexpectedly out-of-sync.
- This module was initially built to suit a public REST API over Private Link and as such, depended on a Network Load Balancer (NLB) to function with VPC Link. You can choose to remove this dependency for private API's not using the `regional` or `edge` deployment type.
  <br>

## Special Notes

- (Merge Mode)
  - When importing Open API Specifications with the `body` argument, by default the API Gateway REST API will be replaced with the Open API Specification thus removing any existing methods, resources, integrations, or endpoints. Endpoint mutations are asynchronous operations, and race conditions with DNS are possible. To overcome this limitation, use the `put_rest_api_mode` attribute and set it to `merge`.
  - Using `put_rest_api_mode` = `merge` when importing the OpenAPI Specification, the AWS control plane WILL NOT delete all existing literal properties that are not explicitly set in the OpenAPI definition. Impacted API Gateway properties: ApiKeySourceType, BinaryMediaTypes, Description, EndpointConfiguration, MinimumCompressionSize, Name, Policy).
  - When using `put_rest_api_mode` = `merge`, and you rename/remove a resource in the body, that resource change WILL NOT be reflected in the console.
  - When using `put_rest_api_mode` = `overwrite`, the AWS APIGW console reflects all changes you make accurately. However, be aware of the warning issued by the provider about using `overwrite` mode. We have not experienced issues using it so far with this module and implementation but in tests, we have only toggled this mode when we are renaming resource paths or removing resources from the body altogether.
- (PRIVATE Type API Endpoint)
  - When a REST API type of `PRIVATE` is needed, the VPC endpoints must be specified in the `openapi.yaml` definition. This is especially called out since it is not obvious as most modules allow setting this in the Terraform input block.
    ```
      x-amazon-apigateway-endpoint-configuration:
        vpcEndpointIds: [""]
        disableExecuteApiEndpoint: true
    ```
- (Deployments History vs. Deployment being used)
  - We deploy every time using `(timestamp()}` in the `aws_api_gateway_deployment` resource. If we do not, sometimes the
    deployment history has new deployments but the actual deployment in-use by the stage might be an older one.
  - Currently there is almost always one deployment, which is the most recent one. When there are multiple deployments in history, only the most recent will be used by default.
  - Domain names supports only one ACM Certificate for all the domain names, so the certificate must be valid for all the chosen domain names.
- (Using Existing Domains) \* In the case where you need to use an existing domain (e.g. `create_api_domain_name = false`), ensure that both `domain_names` and `domain_base_path` are set to the desired values.
  <br>

## Custom Domain Configuration Modes

This module supports three modes for custom domain configuration:

### 1. No Custom Domain (Default AWS Endpoint)

Use the default AWS-provided API Gateway endpoint without any custom domain:

```hcl
module "api_gateway" {
  source = "github.com/adamwshero/terraform-aws-api-gateway"

  api_name            = "my-api"
  openapi_definition  = file("openapi.yaml")
  stage_names         = ["dev", "prod"]

  # No custom domain - use default AWS endpoint
  create_api_domain_name = false
  domain_names           = null  # or []

  # ... other configuration
}
```

### 2. Create New Custom Domain

Create new custom domain name(s) managed by this module:

```hcl
module "api_gateway" {
  source = "github.com/adamwshero/terraform-aws-api-gateway"

  api_name            = "my-api"
  openapi_definition  = file("openapi.yaml")
  stage_names         = ["dev", "prod"]

  # Create new custom domains
  create_api_domain_name = true
  domain_names           = ["api-dev.example.com", "api-prod.example.com"]
  domain_certificate_arn = "arn:aws:acm:..."
  certificate_type       = "ACM"

  # ... other configuration
}
```

### 3. Use Existing Custom Domain

Map to existing custom domain name(s) created outside this module:

```hcl
module "api_gateway" {
  source = "github.com/adamwshero/terraform-aws-api-gateway"

  api_name            = "my-api"
  openapi_definition  = file("openapi.yaml")
  stage_names         = ["dev", "prod"]

  # Use existing custom domains
  create_api_domain_name = false
  domain_names           = ["existing-api-dev.example.com", "existing-api-prod.example.com"]
  domain_base_path       = "/v1"

  # ... other configuration
}
```

## Upcoming/Recent Improvements

- <s>Want `aws_api_gateway_method_settings` to allow us to apply different method settings by stage and by method instead of choosing between the full override `*/*` or only a single method to manage (e.g. `{resource_path}/{http_method}`). Currently whatever the path is dictates all method settings for the stages that have been deployed. Method settings would be represented as a `map` just as we already do with api keys and usage plans.</s>
  - Fixed in 1.3.0 release
- Want a usage_plan to accept many API keys as a `list(string)`. Currenly a usage plan has a 1:1 relationship with API keys. This should be expanded so that many API keys can be associated with a single usage plan in the event multiple external consumers have similar API needs. This will reduce the number of usage plans needed.
- <s>Want the ability to create/enable VPC Link in this module since we're already consuming the Network Load Balancer (NLB) outputs when we are using the `regional` or `edge` deployment type</s>.
  - [Works well with our VPC Link module](https://registry.terraform.io/modules/adamwshero/api-gateway-vpc-link/aws/latest)

## The More You Know

- CloudWatch Alarms
  - For CloudWatch Cache Hit/Miss alarms to work, you must enable the cache cluster for the stage.
- NLB Health Checks
  - Ensure you are using the same availability zones from your NLB all the way to the target ALB where your service is running. Otherwise, you will see NLB targets (which are VPC endpint IP's) that are in an unhealthy state.
- NLB Target Groups
  - At the time of this writing, there is an open issue for NLB's specifically where you will only be able to have 1 target group for a listener in Terraform (e.g. 443). Because of this, we must deploy an NLB, & VPCLink for each API instead of having 1 NLB and many target groups for each API. [See this issue opened for the AWS CDK (is not a CDK issue alone)](https://github.com/aws/aws-cdk/issues/11943)
- VPCLink + Private Link
  _ In the case where we are using private link + VPC Link to connect a REST API to a target service, it is important to know that the integration URI needed for the API integration request needs to match the domain/cert that is being used at the ALB level closest to the target service. Do not point the integration URI to the network load balancer. If the ALB listener for the application has a cert attached for `_.nonprod.mycompany.com`, the integration URI for the API needs to also use that domain `(e.g. my-app.nonprod.mycompany.com)` to avoid a cert mismatch error.
  <br>

### Terraform Basic Example

```
module "rest-api" {
  source = "git::git@github.com:adamwshero/terraform-aws-api-gateway.git//.?ref=1.4.1"


inputs = {
  api_name          = "my-app-dev"
  description       = "Development API for the My App service."
  endpoint_type     = "REGIONAL"
  put_rest_api_mode = "merge"   // Toggle to `overwrite` only when renaming a resource path or removing a resource from the openapi definition.

  // API Definition & Vars
  openapi_definition = templatefile("${get_terragrunt_dir()}/openapi.yaml",
    {
      endpoint_uri             = "https://my-app.nonprod.company.com}/my_app_path"
      authorizer_invoke_arn    = "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:111111111111:function:my-app-dev/invocation"
      authorizer_execution_arn = "arn:aws:iam::111111111111:role/my-app-dev"
    }
  )

  // Stage Settings
  stage_names           = ["dev"]
  stage_description     = "Development stage for My App API"
  log_group_name        = "/aws/apigateway/access/my_app/dev"
  access_log_format     = templatefile("${get_terragrunt_dir()}/log_format.json.tpl", {})

  // Method Settings
  method_settings = {
    "dev /*/*" = {
      metrics_enabled                            = true
      logging_level                              = "INFO"
      data_trace_enabled                         = true
      throttling_burst_limit                     = 100
      throttling_rate_limit                      = 100
      caching_enabled                            = true
      cache_ttl_in_seconds                       = 300
      cache_data_encrypted                       = true
      require_authorization_for_cache_control    = true
      unauthorized_cache_control_header_strategy = "FAIL_WITH_403"
    }
  }

  // Security
  enable_waf = false

  // Execution Role
  cloudwatch_role_arn    = "arn:aws:iam::111111111111:role/my-app"
  cloudwatch_policy_name = "my-app-dev"

  // Usage Plans & API Keys
  create_usage_plan = false
  enable_api_key    = false

  tags = local.tags
}
```

### Terragrunt Basic Example

```
terraform {
  source = "git::git@github.com:adamwshero/terraform-aws-api-gateway.git//.?ref=1.4.1"
}

inputs = {
  api_name          = "my-app-dev"
  description       = "Development API for the My App service."
  endpoint_type     = "REGIONAL"
  put_rest_api_mode = "merge"   // Toggle to `overwrite` only when renaming a resource path or removing a resource from the openapi definition.

  // API Definition & Vars
  openapi_definition = templatefile("${get_terragrunt_dir()}/openapi.yaml",
    {
      endpoint_uri             = "https://my-app.nonprod.company.com}/my_app_path"
      authorizer_invoke_arn    = "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:111111111111:function:my-app-dev/invocation"
      authorizer_execution_arn = "arn:aws:iam::111111111111:role/my-app-dev"
    }
  )

  // Stage Settings
  stage_names       = ["dev"]
  stage_description = "Development stage for My App API"
  log_group_name    = "/aws/apigateway/access/my_app/dev"
  access_log_format = templatefile("${get_terragrunt_dir()}/log_format.json.tpl", {})

  // Method Settings
  method_settings = {
    "dev /*/*" = {
      metrics_enabled                            = true
      logging_level                              = "INFO"
      data_trace_enabled                         = true
      throttling_burst_limit                     = 100
      throttling_rate_limit                      = 100
      caching_enabled                            = true
      cache_ttl_in_seconds                       = 300
      cache_data_encrypted                       = true
      require_authorization_for_cache_control    = true
      unauthorized_cache_control_header_strategy = "FAIL_WITH_403"
    }
  }

  // Security
  enable_waf = false

  // Execution Role
  cloudwatch_role_arn    = "arn:aws:iam::111111111111:role/my-app"
  cloudwatch_policy_name = "my-app-dev"

  // Usage Plans & API Keys
  create_usage_plan = false
  enable_api_key    = false

  tags = local.tags
}
```

## Supporting Articles & Documentation

- Working with AWS API Gateway Extensions to OpenAPI
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions.html
- AWS API Gateway Dimensions & Metrics
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-metrics-and-dimensions.html
- OpenAPI Specification
  - https://github.com/OAI/OpenAPI-Specification
  - https://spec.openapis.org/oas/v3.1.0#openapi-specification
  - https://swagger.io/docs/specification/about/
- IAM Role & Policy requirements for CloudWatch Logging
  - https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html

<!-- DO NOT REMOVE THE LINE BELOW  Self generated TF DOCS -->
<!-- Generated with https://github.com/terraform-docs/terraform-docs
<!-- BEGIN_TF_DOCS -->

## Requirements

| Name                                                                     | Version            |
| ------------------------------------------------------------------------ | ------------------ |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 0.13.1          |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | >= 5.5.0, < 5.75.0 |

## Providers

| Name                                             | Version            |
| ------------------------------------------------ | ------------------ |
| <a name="provider_aws"></a> [aws](#provider_aws) | >= 5.5.0, < 5.75.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                        | Type     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| [aws_api_gateway_account.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_account)                             | resource |
| [aws_api_gateway_api_key.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_api_key)                             | resource |
| [aws_api_gateway_base_path_mapping.edge_acm](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_base_path_mapping)     | resource |
| [aws_api_gateway_base_path_mapping.edge_iam](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_base_path_mapping)     | resource |
| [aws_api_gateway_base_path_mapping.existing](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_base_path_mapping)     | resource |
| [aws_api_gateway_base_path_mapping.regional_acm](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_base_path_mapping) | resource |
| [aws_api_gateway_base_path_mapping.regional_iam](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_base_path_mapping) | resource |
| [aws_api_gateway_deployment.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_deployment)                       | resource |
| [aws_api_gateway_domain_name.edge_acm](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name)                 | resource |
| [aws_api_gateway_domain_name.edge_iam](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name)                 | resource |
| [aws_api_gateway_domain_name.regional_acm](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name)             | resource |
| [aws_api_gateway_domain_name.regional_iam](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name)             | resource |
| [aws_api_gateway_method_settings.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method_settings)             | resource |
| [aws_api_gateway_model.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_model)                                 | resource |
| [aws_api_gateway_rest_api.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_rest_api)                           | resource |
| [aws_api_gateway_rest_api_policy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_rest_api_policy)             | resource |
| [aws_api_gateway_stage.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage)                                 | resource |
| [aws_api_gateway_usage_plan.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_usage_plan)                       | resource |
| [aws_api_gateway_usage_plan_key.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_usage_plan_key)               | resource |
| [aws_cloudwatch_log_group.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group)                           | resource |
| [aws_wafv2_web_acl_association.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/wafv2_web_acl_association)                 | resource |

## Inputs

| Name                                                                                                                                                            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Type                                                                                                                                                                                                                                                     | Default                                                                                                                                                                                                                                            | Required |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_access_log_format"></a> [access_log_format](#input_access_log_format)                                                                            | (Required) Formatting and values recorded in the logs. For more information on configuring the log format rules visit the AWS documentation                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                |   yes    |
| <a name="input_api_key_description"></a> [api_key_description](#input_api_key_description)                                                                      | (Optional) API key description. Defaults to `Managed by Terraform`.                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_api_key_name"></a> [api_key_name](#input_api_key_name)                                                                                           | (Required) Name of the API key.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_api_keys"></a> [api_keys](#input_api_keys)                                                                                                       | Map of objects that define the usage plan to be created.                                                                                                                                                                                                                                                                                                                                                                                                                                              | <pre>list(<br/> object({<br/> name = string<br/> key_type = string<br/> usage_plan = string<br/> })<br/> )</pre>                                                                                                                                         | <pre>[<br/> {<br/> "key_type": null,<br/> "name": null,<br/> "usage_plan": null<br/> }<br/>]</pre>                                                                                                                                                 |    no    |
| <a name="input_api_name"></a> [api_name](#input_api_name)                                                                                                       | (Required) Name of the REST API. If importing an OpenAPI specification via the `body` argument, this corresponds to the `info.title` field. If the argument value is different than the OpenAPI value, the argument value will override the OpenAPI value.                                                                                                                                                                                                                                            | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_burst_limit"></a> [burst_limit](#input_burst_limit)                                                                                              | (Optional) - The API request burst limit, the maximum rate limit over a time ranging from one to a few seconds, depending upon whether the underlying token bucket is at its full capacity.                                                                                                                                                                                                                                                                                                           | `number`                                                                                                                                                                                                                                                 | `5`                                                                                                                                                                                                                                                |    no    |
| <a name="input_cache_cluster_enabled"></a> [cache_cluster_enabled](#input_cache_cluster_enabled)                                                                | (Optional) Whether a cache cluster is enabled for the stage.                                                                                                                                                                                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                   | `true`                                                                                                                                                                                                                                             |    no    |
| <a name="input_cache_cluster_size"></a> [cache_cluster_size](#input_cache_cluster_size)                                                                         | (Optional) Size of the cache cluster for the stage, if enabled. Allowed values include `0.5`, `1.6`, `6.1`, `13.5`, `28.4`, `58.2`, `118` and `237`.                                                                                                                                                                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                 | `0.5`                                                                                                                                                                                                                                              |    no    |
| <a name="input_cache_data_encrypted"></a> [cache_data_encrypted](#input_cache_data_encrypted)                                                                   | (Optional) Whether the cached responses are encrypted.                                                                                                                                                                                                                                                                                                                                                                                                                                                | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_cache_ttl_in_seconds"></a> [cache_ttl_in_seconds](#input_cache_ttl_in_seconds)                                                                   | (Optional) Time to live (TTL), in seconds, for cached responses. The higher the TTL, the longer the response will be cached.                                                                                                                                                                                                                                                                                                                                                                          | `number`                                                                                                                                                                                                                                                 | `300`                                                                                                                                                                                                                                              |    no    |
| <a name="input_caching_enabled"></a> [caching_enabled](#input_caching_enabled)                                                                                  | (Optional) Whether responses should be cached and returned for requests. A cache cluster must be enabled on the stage for responses to be cached.                                                                                                                                                                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                                   | `true`                                                                                                                                                                                                                                             |    no    |
| <a name="input_certificate_type"></a> [certificate_type](#input_certificate_type)                                                                               | This resource currently only supports managing a single value. Valid values: `ACM` or `IAM`. If unspecified, defaults to `acm`                                                                                                                                                                                                                                                                                                                                                                        | `string`                                                                                                                                                                                                                                                 | `"ACM"`                                                                                                                                                                                                                                            |    no    |
| <a name="input_client_certificate_id"></a> [client_certificate_id](#input_client_certificate_id)                                                                | (Optional) Identifier of a client certificate for the stage.                                                                                                                                                                                                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_client_name"></a> [client_name](#input_client_name)                                                                                              | client name to use this api.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_cloudwatch_role_arn"></a> [cloudwatch_role_arn](#input_cloudwatch_role_arn)                                                                      | (Required) for the `api_gateway_account` resource.                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_create_api_domain_name"></a> [create_api_domain_name](#input_create_api_domain_name)                                                             | Whether to create API domain name resource.                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_create_rest_api_policy"></a> [create_rest_api_policy](#input_create_rest_api_policy)                                                             | Enables creation of the resource policy for a given API.                                                                                                                                                                                                                                                                                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                   | `true`                                                                                                                                                                                                                                             |    no    |
| <a name="input_create_usage_plan"></a> [create_usage_plan](#input_create_usage_plan)                                                                            | Allows creation of a usage plan. (Requires `var.enable_api_key = true`)                                                                                                                                                                                                                                                                                                                                                                                                                               | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_data_trace_enabled"></a> [data_trace_enabled](#input_data_trace_enabled)                                                                         | (Optional) Whether data trace logging is enabled for this method, which effects the log entries pushed to Amazon CloudWatch Logs.                                                                                                                                                                                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_description"></a> [description](#input_description)                                                                                              | (Optional) Description of the REST API. If importing an OpenAPI specification via the `body` argument, this corresponds to the `info.description` field. If the argument value is provided and is different than the OpenAPI value, the argument value will override the OpenAPI value.                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_documentation_version"></a> [documentation_version](#input_documentation_version)                                                                | (Optional) Version of the associated API documentation.                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_domain_base_path"></a> [domain_base_path](#input_domain_base_path)                                                                               | (Optional) Path segment that must be prepended to the path when accessing the API via this mapping. If omitted, the API is exposed at the root of the given domain.                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                 | `"/"`                                                                                                                                                                                                                                              |    no    |
| <a name="input_domain_certificate_arn"></a> [domain_certificate_arn](#input_domain_certificate_arn)                                                             | The ARN of an AWS-managed certificate that will be used by the endpoint for the domain name.                                                                                                                                                                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_domain_certificate_name"></a> [domain_certificate_name](#input_domain_certificate_name)                                                          | Unique name to use when registering this certificate as an IAM server certificate. Conflicts with certificate_arn, regional_certificate_arn, and regional_certificate_name. Required if certificate_arn is not set.                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_domain_names"></a> [domain_names](#input_domain_names)                                                                                           | Fully-qualified domain name to register. The domain names to use for API gateway it will use the index of stage_names to select the domain name.                                                                                                                                                                                                                                                                                                                                                      | `list(string)`                                                                                                                                                                                                                                           | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_enable_api_key"></a> [enable_api_key](#input_enable_api_key)                                                                                     | (Optional) Whether the API key can be used by callers. Defaults to `false`.                                                                                                                                                                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_enable_canary"></a> [enable_canary](#input_enable_canary)                                                                                        | (Optional) Whether to use the values supplied for the canary and stage_variable_overrides or not.                                                                                                                                                                                                                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_enable_waf"></a> [enable_waf](#input_enable_waf)                                                                                                 | Enables associating existing WAF ACL to all stages.                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_endpoint_type"></a> [endpoint_type](#input_endpoint_type)                                                                                        | (Required) List of endpoint types. This resource currently only supports managing a single value. Valid values: `EDGE`, `REGIONAL` or `PRIVATE`. If unspecified, defaults to `EDGE`. Must be declared as `REGIONAL` in non-Commercial partitions. If set to `PRIVATE` recommend to set put_rest_api_mode = merge to not cause the endpoints and associated Route53 records to be deleted. Refer to the documentation for more information on the difference between edge-optimized and regional APIs. | `string`                                                                                                                                                                                                                                                 | `"EDGE"`                                                                                                                                                                                                                                           |    no    |
| <a name="input_iam_certificate_body"></a> [iam_certificate_body](#input_iam_certificate_body)                                                                   | Certificate issued for the domain name being registered, in PEM format. Only valid for EDGE endpoint configuration type. Conflicts with certificate_arn, regional_certificate_arn, and regional_certificate_name                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_iam_certificate_chain"></a> [iam_certificate_chain](#input_iam_certificate_chain)                                                                | Certificate for the CA that issued the certificate, along with any intermediate CA certificates required to create an unbroken chain to a certificate trusted by the intended API clients. Only valid for EDGE endpoint configuration type. Conflicts with certificate_arn, regional_certificate_arn, and regional_certificate_name.                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_iam_certificate_private_key"></a> [iam_certificate_private_key](#input_iam_certificate_private_key)                                              | Private key associated with the domain certificate given in certificate_body. Only valid for EDGE endpoint configuration type. Conflicts with certificate_arn, regional_certificate_arn, and regional_certificate_name.                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_limit"></a> [limit](#input_limit)                                                                                                                | (Optional) - Maximum number of requests that can be made in a given time period.                                                                                                                                                                                                                                                                                                                                                                                                                      | `number`                                                                                                                                                                                                                                                 | `20`                                                                                                                                                                                                                                               |    no    |
| <a name="input_log_group_kms_key"></a> [log_group_kms_key](#input_log_group_kms_key)                                                                            | (Optional) The ARN of the KMS Key to use when encrypting log data. Please note, after the AWS KMS CMK is disassociated from the log group, AWS CloudWatch Logs stops encrypting newly ingested data for the log group. All previously ingested data remains encrypted, and AWS CloudWatch Logs requires permissions for the CMK whenever the encrypted data is requested.                                                                                                                             | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_log_group_name"></a> [log_group_name](#input_log_group_name)                                                                                     | (Optional, Forces new resource) The name of the log group. If omitted, Terraform will assign a random, unique name.                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_log_group_retention_in_days"></a> [log_group_retention_in_days](#input_log_group_retention_in_days)                                              | (Optional) Specifies the number of days you want to retain log events in the specified log group. Possible values are: 1, 3, 5, 7, 14, 30, 60, 90, 120, 150, 180, 365, 400, 545, 731, 1827, 3653, and 0. If you select 0, the events in the log group are always retained and never expire.                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                 | `7`                                                                                                                                                                                                                                                |    no    |
| <a name="input_logging_level"></a> [logging_level](#input_logging_level)                                                                                        | (Optional) Logging level for this method, which effects the log entries pushed to Amazon CloudWatch Logs. The available levels are OFF, ERROR, and INFO.                                                                                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                 | `"INFO"`                                                                                                                                                                                                                                           |    no    |
| <a name="input_method_settings"></a> [method_settings](#input_method_settings)                                                                                  | Stage method settings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `any`                                                                                                                                                                                                                                                    | `{}`                                                                                                                                                                                                                                               |    no    |
| <a name="input_metrics_enabled"></a> [metrics_enabled](#input_metrics_enabled)                                                                                  | (Optional) Whether Amazon CloudWatch metrics are enabled for this method.                                                                                                                                                                                                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                 | `true`                                                                                                                                                                                                                                             |    no    |
| <a name="input_models"></a> [models](#input_models)                                                                                                             | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `any`                                                                                                                                                                                                                                                    | `{}`                                                                                                                                                                                                                                               |    no    |
| <a name="input_mutual_tls_authentication"></a> [mutual_tls_authentication](#input_mutual_tls_authentication)                                                    | An Amazon S3 URL that specifies the truststore for mutual TLS authentication as well as version, keyed at uri and version                                                                                                                                                                                                                                                                                                                                                                             | `map(string)`                                                                                                                                                                                                                                            | `{}`                                                                                                                                                                                                                                               |    no    |
| <a name="input_offset"></a> [offset](#input_offset)                                                                                                             | (Optional) - Number of requests subtracted from the given limit in the initial time period.                                                                                                                                                                                                                                                                                                                                                                                                           | `number`                                                                                                                                                                                                                                                 | `2`                                                                                                                                                                                                                                                |    no    |
| <a name="input_openapi_definition"></a> [openapi_definition](#input_openapi_definition)                                                                         | (Required) YAML formatted definition file using OpenAPI 3.x specification. This definition contains all API configuration inputs. Any inputs used in Terraform will override inputs in the definition.                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                |   yes    |
| <a name="input_percent_traffic"></a> [percent_traffic](#input_percent_traffic)                                                                                  | (Optional) Percent 0.0 - 100.0 of traffic to divert to the canary deployment.                                                                                                                                                                                                                                                                                                                                                                                                                         | `number`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_period"></a> [period](#input_period)                                                                                                             | (Optional) - Time period in which the limit applies. Valid values are `DAY`, `WEEK` or `MONTH`.                                                                                                                                                                                                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                 | `"WEEK"`                                                                                                                                                                                                                                           |    no    |
| <a name="input_put_rest_api_mode"></a> [put_rest_api_mode](#input_put_rest_api_mode)                                                                            | (Optional) Mode of the PutRestApi operation when importing an OpenAPI specification via the body argument (create or update operation). Valid values are merge and overwrite. If unspecificed, defaults to overwrite (for backwards compatibility). This corresponds to the x-amazon-apigateway-put-integration-method extension. If the argument value is provided and is different than the OpenAPI value, the argument value will override the OpenAPI value.                                      | `string`                                                                                                                                                                                                                                                 | `"overwrite"`                                                                                                                                                                                                                                      |    no    |
| <a name="input_rate_limit"></a> [rate_limit](#input_rate_limit)                                                                                                 | (Optional) - The API request steady-state rate limit.                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `number`                                                                                                                                                                                                                                                 | `10`                                                                                                                                                                                                                                               |    no    |
| <a name="input_require_authorization_for_cache_control"></a> [require_authorization_for_cache_control](#input_require_authorization_for_cache_control)          | (Optional) Whether authorization is required for a cache invalidation request.                                                                                                                                                                                                                                                                                                                                                                                                                        | `bool`                                                                                                                                                                                                                                                   | `true`                                                                                                                                                                                                                                             |    no    |
| <a name="input_rest_api_policy"></a> [rest_api_policy](#input_rest_api_policy)                                                                                  | (Required) JSON formatted policy document that controls access to the API Gateway. For more information about building AWS IAM policy documents with Terraform, see the AWS IAM Policy Document Guide                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                 | `""`                                                                                                                                                                                                                                               |    no    |
| <a name="input_stage_description"></a> [stage_description](#input_stage_description)                                                                            | (Optional) Description of the stage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_stage_names"></a> [stage_names](#input_stage_names)                                                                                              | (Required) Name of the stage(s).                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `list(string)`                                                                                                                                                                                                                                           | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_stage_variable_overrides"></a> [stage_variable_overrides](#input_stage_variable_overrides)                                                       | (Optional) Map of overridden stage variables (including new variables) for the canary deployment.                                                                                                                                                                                                                                                                                                                                                                                                     | `any`                                                                                                                                                                                                                                                    | `{}`                                                                                                                                                                                                                                               |    no    |
| <a name="input_stage_variables"></a> [stage_variables](#input_stage_variables)                                                                                  | (Optional) Map that defines the stage variables.                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `any`                                                                                                                                                                                                                                                    | `{}`                                                                                                                                                                                                                                               |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                                                   | A map of tags to assign to resources.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `map(string)`                                                                                                                                                                                                                                            | `{}`                                                                                                                                                                                                                                               |    no    |
| <a name="input_throttling_burst_limit"></a> [throttling_burst_limit](#input_throttling_burst_limit)                                                             | (Optional) Throttling burst limit. Default: -1 (throttling disabled).                                                                                                                                                                                                                                                                                                                                                                                                                                 | `number`                                                                                                                                                                                                                                                 | `-1`                                                                                                                                                                                                                                               |    no    |
| <a name="input_throttling_rate_limit"></a> [throttling_rate_limit](#input_throttling_rate_limit)                                                                | (Optional) Throttling rate limit. Default: -1 (throttling disabled).                                                                                                                                                                                                                                                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                 | `-1`                                                                                                                                                                                                                                               |    no    |
| <a name="input_unauthorized_cache_control_header_strategy"></a> [unauthorized_cache_control_header_strategy](#input_unauthorized_cache_control_header_strategy) | (Optional) How to handle unauthorized requests for cache invalidation. The available values are `FAIL_WITH_403`, `SUCCEED_WITH_RESPONSE_HEADER`, `SUCCEED_WITHOUT_RESPONSE_HEADER`.                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                 | `"SUCCEED_WITH_RESPONSE_HEADER"`                                                                                                                                                                                                                   |    no    |
| <a name="input_usage_plans"></a> [usage_plans](#input_usage_plans)                                                                                              | Map of objects that define the usage plan to be created.                                                                                                                                                                                                                                                                                                                                                                                                                                              | <pre>list(<br/> object({<br/> name = string<br/> description = string<br/> burst_limit = number<br/> rate_limit = number<br/> quota_limit = number<br/> quota_offset = number<br/> quota_period = string<br/> stages = list(string)<br/> })<br/> )</pre> | <pre>[<br/> {<br/> "burst_limit": null,<br/> "description": null,<br/> "name": null,<br/> "quota_limit": null,<br/> "quota_offset": null,<br/> "quota_period": null,<br/> "rate_limit": null,<br/> "stages": [<br/> null<br/> ]<br/> }<br/>]</pre> |    no    |
| <a name="input_use_stage_cache"></a> [use_stage_cache](#input_use_stage_cache)                                                                                  | (Optional) Whether the canary deployment uses the stage cache. Defaults to false.                                                                                                                                                                                                                                                                                                                                                                                                                     | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |
| <a name="input_waf_acl"></a> [waf_acl](#input_waf_acl)                                                                                                          | (Required) The ID of the WAF Regional WebACL to create an association.                                                                                                                                                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                 | `null`                                                                                                                                                                                                                                             |    no    |
| <a name="input_xray_tracing_enabled"></a> [xray_tracing_enabled](#input_xray_tracing_enabled)                                                                   | (Optional) Whether active tracing with X-ray is enabled. Defaults to false.                                                                                                                                                                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                   | `false`                                                                                                                                                                                                                                            |    no    |

## Outputs

| Name                                                                                                                                                        | Description                              |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| <a name="output_api_gateway_rest_api_arn"></a> [api_gateway_rest_api_arn](#output_api_gateway_rest_api_arn)                                                 | Arn of the REST API.                     |
| <a name="output_api_gateway_rest_api_execution_arn"></a> [api_gateway_rest_api_execution_arn](#output_api_gateway_rest_api_execution_arn)                   | Execution Arn of the REST API.           |
| <a name="output_api_gateway_rest_api_id"></a> [api_gateway_rest_api_id](#output_api_gateway_rest_api_id)                                                    | Id of the REST API.                      |
| <a name="output_api_gateway_rest_api_name"></a> [api_gateway_rest_api_name](#output_api_gateway_rest_api_name)                                              | Name of the REST API.                    |
| <a name="output_api_gateway_rest_api_stage_arn"></a> [api_gateway_rest_api_stage_arn](#output_api_gateway_rest_api_stage_arn)                               | Arn of the deployed stage(s).            |
| <a name="output_api_gateway_rest_api_stage_execution_arn"></a> [api_gateway_rest_api_stage_execution_arn](#output_api_gateway_rest_api_stage_execution_arn) | Execution arn of the deployed stage(s).  |
| <a name="output_api_gateway_rest_api_stage_id"></a> [api_gateway_rest_api_stage_id](#output_api_gateway_rest_api_stage_id)                                  | Id of the deployed stage(s).             |
| <a name="output_api_gateway_rest_api_stage_invoke_url"></a> [api_gateway_rest_api_stage_invoke_url](#output_api_gateway_rest_api_stage_invoke_url)          | Invoke URL of the deployed stage(s).     |
| <a name="output_api_gateway_rest_api_stage_web_acl"></a> [api_gateway_rest_api_stage_web_acl](#output_api_gateway_rest_api_stage_web_acl)                   | WAF Access Control List for the stage(s) |
| <a name="output_aws_api_gateway_domain_name"></a> [aws_api_gateway_domain_name](#output_aws_api_gateway_domain_name)                                        | api gateway domain name                  |

<!-- END_TF_DOCS -->
